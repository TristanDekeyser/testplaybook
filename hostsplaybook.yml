- name: Playbook voor inventory's te maken
  hosts: machines
  gather_facts: yes
  tasks:
    - name: Voeg gelukte hosts toe aan variabele
      set_fact:
        gelukte_hosts: "{{ (gelukte_hosts | default([])) + [inventory_hostname] }}"
      when: ansible_facts is not failed and ansible_facts is not unreachable

    - name: Voeg mislukte hosts toe aan variabele
      set_fact:
        mislukte_hosts: "{{ (ansible_play_hosts_all | difference(gelukte_hosts)) }}"
      when: ansible_facts is failed or ansible_facts is unreachable

    - name: Verzend mislukte hosts naar custom inventory module
      inventory:
        mislukte_hosts: "{{ mislukte_hosts }}"
      when: mislukte_hosts | length > 0
      register: output
      run_once: yes

    - name: Toon hosts
      debug:
        msg:
          - "succesvolle hosts: {{ gelukte_hosts | default([]) }}"
          - "mislukte hosts: {{ mislukte_hosts | default([]) }}"
          - "alle hosts: {{ ansible_play_hosts_all }}"
      run_once: yes
